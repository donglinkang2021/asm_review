## 习题

<details>
<summary>2.5 以下为实模式用段基址:偏移量形式表示的内存地址，试计算他们的物理地址

1. `12F8:0100`
2. `1A2F:0103`
3. `1A3F:0003`
4. `1A3F:A1FF`

</summary>

1. `12F8:0100 = 12F80 + 0100 = 13080`
2. `1A2F:0103 = 1A2F0 + 0103 = 1A3F3`
3. `1A3F:0003 = 1A3F0 + 0003 = 1A3F3`
4. `1A3F:A1FF = 1A3F0 + A1FF = 245EF`

</details>

<details>
<summary>2.9 已知某数据段描述符存放在01010550H起始的单元，该描述符的字为`01010550H=2014H, 01010552H=0000H, 01010554=1A20H, 01010556H=0428H`，该数据段的基址为多少，限长为多少，试分析该数据段属性</summary>

解答：

可以写成如下形式：

```asm
01010550: 20 14 00 00 1A 20 04 28
```

<details>
<summary>段描述符表</summary>

<div>
<table>
    <tr>
        <td>+0</td>
        <td colspan="8" align=center>限长 (位7~0)</td>
    </tr>
    <tr>
        <td>+1</td>
        <td colspan="8" align=center>限长 (位15~8)</td>
    </tr>
    <tr>
        <td>+2</td>
        <td colspan="8" align=center>段基址 (位7~0)</td>
    </tr>
    <tr>
        <td>+3</td>
        <td colspan="8" align=center>段基址 (位15~8)</td>
    </tr>
    <tr>
        <td>+4</td>
        <td colspan="8" align=center>段基址 (位23~16)</td>
    </tr>
    <tr>
        <td>+5</td>
        <td colspan="1" align=center> P </td>
        <td colspan="2" align=center> DPL </td>
        <td colspan="1" align=center> S </td>
        <td colspan="4" align=center> TYPE </td>
    </tr>
    <tr>
        <td>+6</td>
        <td colspan="1" align=center> G </td>
        <td colspan="1" align=center> D </td>
        <td colspan="1" align=center> 0 </td>
        <td colspan="1" align=center> AVL </td>
        <td colspan="4" align=center> 限长 (位19~16)</td>
    </tr>
    <tr>
        <td>+7</td>
        <td colspan="8" align=center>段基址 (位31~24)</td>
    </tr>
</table>
</div>
</details>

解析：

限长为`041420H`，段基址为`281A0000H`，属性为`P=0, DPL=01, S=0, TYPE=000, A=0, G=0, D=0, AVL=0`。


</details>



<details>
<summary>2.15 若某段选择符为（0000 0000 0010 1011）B，DTbase=E003F000H，Limit=03FFH，物理内存部分内容如下

```asm
E003F000: 00 00 00 00 00 00 00 00-FF FF 00 00 00 9B CF 00
E003F010: FF FF 00 00 00 93 CF 00-FF FF 00 00 00 FB CF 00
E003F020: FF FF 00 00 00 F3 CF 00-AB 20 00 20 04 8B 00 80 
E003F030: 01 00 00 F0 DF 93 C0 FF-FF 0F 00 00 00 F3 40 00
```

则GDT内有多少个描述符？该段选择符对应的RPL是什么？段描述符所在地址范围是什么？段描述符内容和属性各为什么？

</summary>

段选择符为 <font color=red>0000 0000 0010 1</font><font color=green>0</font><font color=blue>11</font>，此时index为5，RPL为3，TI为0，说明该段选择符指向GDT表中的第5个描述符，即`E003F028`处的描述符`AB 20 00 20 04 8B 00 80`，地址范围：0E003F028H ~ 0E003F02FH。

段描述符的内容及属性为：

<details>
<summary>段描述符表</summary>

<div>
<table>
    <tr>
        <td>+0</td>
        <td colspan="8" align=center>限长 (位7~0)</td>
    </tr>
    <tr>
        <td>+1</td>
        <td colspan="8" align=center>限长 (位15~8)</td>
    </tr>
    <tr>
        <td>+2</td>
        <td colspan="8" align=center>段基址 (位7~0)</td>
    </tr>
    <tr>
        <td>+3</td>
        <td colspan="8" align=center>段基址 (位15~8)</td>
    </tr>
    <tr>
        <td>+4</td>
        <td colspan="8" align=center>段基址 (位23~16)</td>
    </tr>
    <tr>
        <td>+5</td>
        <td colspan="1" align=center> P </td>
        <td colspan="2" align=center> DPL </td>
        <td colspan="1" align=center> S </td>
        <td colspan="4" align=center> TYPE </td>
    </tr>
    <tr>
        <td>+6</td>
        <td colspan="1" align=center> G </td>
        <td colspan="1" align=center> D </td>
        <td colspan="1" align=center> 0 </td>
        <td colspan="1" align=center> AVL </td>
        <td colspan="4" align=center> 限长 (位19~16)</td>
    </tr>
    <tr>
        <td>+7</td>
        <td colspan="8" align=center>段基址 (位31~24)</td>
    </tr>
</table>
</div>
</details>


- 限长：`20ABH`
- 段基址：`80042000H`
- 属性位：`1000 1011 0000`

</details>

<details>
<summary>
2.24 已知某时刻寄存器中的内容如下所示（16进制）：

```asm
CS=001BH
DS=0023H
ES=0023H
SS=0023H
FS=0030H
GS=0000H
GDTbase=E003F000H
Limit=03FFH
```

内存中部分地址的内容如下所示（16进制）

```asm
E003F000: 00 00 00 00 00 00 00 00-FF FF 00 00 00 9B CF 00
E003F010: FF FF 00 00 00 93 CF 00-FF FF 00 00 00 FB CF 00
E003F020: FF FF 00 00 00 F3 CF 00-AB 20 00 20 04 8B 00 80
E003F030: 01 00 00 F0 DF 93 C0 FF-FF 0F 00 00 00 F3 40 00
E003F040: FF FF 00 04 00 F2 00 00-00 00 00 00 00 00 00 00
```

有指令`JMP 000AH:00300030H`，试说明此刻的CPL，RPL和DPL各是多少，段基址是多少？能否跳转成功？说明理由。
</summary>

- 当前代码段寄存器CS的内容为001BH，<font color=blue>0000 0000 0001 1</font><font color=green>0</font><font color=red>11</font>B，所以Current Privilege Level(CPL)为3；
- 跳转指令为`JMP 000AH:00300030H`，段选择符为000AH，<font color=blue>0000 0000 0000 1</font><font color=green>0</font><font color=red>10</font>B，所以Requested Privilege Level(RPL)为2；
  - 观察到TI为</font><font color=green>0</font>，所以是从GDT中选择段描述符，索引为</font><font color=blue>1H</font>，所以段描述符的地址为E003F000H + 1H * 8 = E003F008H；
- 段描述符的内容为`FF FF 00 00 00 9B CF 00`，
  - 其中DPL所在的字节为`9BH`，`1001 1011B`；
  - 对照可知Descriptor Privilege Level(DPL)为0；

<table>
<tr>
    <td colspan="1" align=center> P </td>
    <td colspan="2" align=center> DPL </td>
    <td colspan="1" align=center> S </td>
    <td colspan="1" align=center> W </td>
    <td colspan="1" align=center> C </td>
    <td colspan="1" align=center> R </td>
    <td colspan="1" align=center> A </td>
</tr>
</table>

- 由于 DPL < CPL，所以不满足特权级检查，所以不能跳转成功。

> 跳转成功的条件是DPL >= max(CPL, RPL) 也就是说描述符的特权级在三个特权级中最小就可以访问了

</details>