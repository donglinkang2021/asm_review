## 辅助存储器

PATA接口的传输模式

- PIO模式：CPU执行IN/OUT 指令访问ATA控制器的数据端口，将数据从硬盘读出或者写入硬盘。数据传送率不高，数据传送过程中CPU被占用。
- DMA模式：数据的传送在ATA控制器的端口和内存之间直接进行，不需要通过CPU


```markdown
SATA 采用（ ）电路传输数据。
选择一项：
A. 隔离
B. 屏蔽
C. 差分
D. 并行

答案：C
[解析] SATA采用差分串行电路传输数据
```

串行ATA/SATA

- 取代了传统的ATA，区别主要在于连接电缆和数据传输方式上。数据线7芯，电源线15芯

```markdown
【1分】关于硬盘,下列说法正确的是()。
选择一项或多项:

a. 对硬盘的读写需要累加器的参与，但不同CPU所使用的累加器不同口
b. PATA是并行线，SATA是串行线，PATA的整体速度快于SATA口
c. 当使用直接存储器访问方式读写硬盘时，可以释放CPU口
d. 硬盘本身的缓冲器大小对硬盘的读写优化和读写速度有影响

答案：c、d
[解析] SATA是串行线，PATA是并行线，PATA的整体速度快于SATA口
> GPT
a. 这个说法是不正确的。硬盘的读写过程并不需要累加器的参与，而累加器是CPU内部的寄存器，不同CPU的累加器口可能是不同的，但这与硬盘读写无关。
b. 这个说法也是不正确的。PATA（Parallel ATA）和SATA（Serial ATA）分别是并行ATA和串行ATA接口的缩写。实际上，SATA相对于PATA来说是更现代、更高效的接口，因为串行传输更容易实现高速传输。因此，SATA的整体速度通常比PATA更快。
c. 这个说法是正确的。直接存储器访问（DMA）是一种可以让硬件直接与内存交互而不需要CPU参与的方式。当使用DMA方式读写硬盘时，可以避免CPU的直接参与，从而释放CPU的口（通道）用于执行其他任务，提高系统的效率。
d. 这个说法是正确的。硬盘本身的缓冲器（Buffer）大小会对硬盘的读写性能产生影响。较大的缓冲器可以提高硬盘的读写效率，因为它可以缓存更多的数据，减少对硬盘的频繁访问。
```

## 扇区编址

![disk_arch](images/disk_arch.png)

- 工作原理
  - 磁盘片/2个盘面
  - 磁道：<font color=red>0磁道是硬盘上非常重要的位置</font>。硬盘的主引导记录区（Main Boot Record，MBR）就保存在0磁头0柱面1扇区。
  - 扇区：<font color=red>扇区是最小的读写单位</font>，每个扇区中的数据作为一个单元同时读出或写入，扇区从1开始编号。
- ATA接口的编程模型：扇区编制模式CHS
  - N个磁道对应N个柱面
    - <font color=red>柱面：0, 1, 2, ... , nC-1     (C = Cylinder)</font>
  - N个盘面对应2N个磁头
    - <font color=green>磁头：0, 1, 2, ... , nH-1     (H = Head)</font>
  - 每个磁道又被分为多个扇区
    - <font color=blue>扇区：1, 2, 3, ... , nS     (S = Sector)</font>
  - 总nC×nH×nS个扇区
  - 0柱面0磁头1扇区是整个硬盘的第1个扇区 <C,H,S> = <0,0,1>
  - 每个扇区**512字节**
- LBA编址模式与CHS编制模式互换
  - 设一个扇区在LBA编址模式中的地址为L，在CHS编址模式的地址
为<C，H，S>，0≤C≤nC−1，0≤H≤nH−1，1≤S≤nS，则`L=[(C×nH + H)×nS]+S–1`。
  - 根据L计算<C，H，S>：

```c
S =(L % nS) + 1
H =(L / nS) % nH
C =(L / nS) / nH
```

<details>
<summary>例题：假设一个磁道共有2048个柱面，16个磁头，每个磁道分为64个扇区，每个扇区512字节，该磁盘的总容量共有多少GB?假设一个磁盘的一个逻辑盘块大小为2KB，则逻辑盘块号513所对应的首个扇区的三维物理地址是多少？</summary>

解答：

- 扇区总数：2048×16×64 = 2^11×2^4×2^6=2^21
- 总容量：2^21×512B=2^21×2^9B=2^30B=1GB
- 因为逻辑盘块大小为2KB，所以一个逻辑盘块对应2x1024/512=4个扇区
- 逻辑盘块号513对应的首个扇区的物理地址L为：
  - L = 513x4+1 = 2053
- 根据L计算<C，H，S>：
  - 由`L=[(C×nH + H)×nS]+S–1`得：
  - S = (2053 % 64) + 1 = 6
  - H = (2053 / 64) % 16 = 0
  - C = (2053 / 64) / 16 = 2
- 所以逻辑盘块号513所对应的首个扇区的三维物理地址是<C，H，S> = <2,0,6>

</details>


