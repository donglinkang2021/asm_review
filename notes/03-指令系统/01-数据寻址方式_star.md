## 数据寻址方式

指令的构成

<table>
    <tr>
        <td colspan="1" align=center>
            操作码
        </td>
        <td colspan="1" align=center>
            操作数
        </td>
    </tr>
</table>

- format: `MOV 目标,源`
- function: `目标 <- 源`
- 目标和源是操作数域，各自可以有不同的寻址方式

当访内操作类型允许指定段寄存器时，可以使用**段超越前缀**指定，为了明确指出本条指令要寻址的内存单元在哪个段，如`MOV AX,ES:VER`

- 寻址方式的对象可以是寄存器、立即数、内存单元；

<details>
<summary>立即寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 立即寻址方式 | MOV AX, <font color=red>1234H</font> |

</summary>

- `立即数`  的寻址方式是立即寻址方式；

</details>

<details>
<summary>寄存器寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 寄存器寻址方式 | MOV <font color=red>AX</font>, 1234H |

</summary>

- `寄存器`  的寻址方式是寄存器寻址方式；
  - 若指令中使用的是`BX,SI,DI,EAX,EBX,ECX,EDX,ESI,EDI`
    - 即它们默认与DS段寄存器配合
  - 若使用的是`BP,EBP,ESP`
    - 则缺省情况默认与SS段寄存器配合

</details>

<details>
<summary>直接寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 直接寻址方式 | MOV AX, <font color=red>[1234H]</font> |

</summary>

- `[立即数]`或`内存单元`的寻址方式是直接寻址方式，此时的立即数就是一个有效地址；
  - 比如`MOV VAR, 1234H`，就是将1234H送到VAR所在的内存单元中；
  - 普通变量缺省情况是存放在DS所指向的数据段，
    - 即`MOV VAR, 1234H`等效于`MOV DS:[offset VAR], 1234H`，物理地址为`DS:offset VAR`；
    - 但允许使用段超越前缀指定为其它段。

</details>

<details>
<summary>寄存器间接寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 寄存器间接寻址方式 | MOV AX, <font color=red>[BX]</font> |

</summary>

- `[寄存器]`的寻址方式是寄存器间接寻址方式，此时的寄存器中存放的是一个地址；
  - 操作数有效地址在基址寄存器BX、BP或变址寄存器SI、DI中
  - 间接寻址的寄存器不可以是AX、CX这种

</details>

<details>
<summary>寄存器相对寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 寄存器相对寻址方式 | MOV AX, <font color=red>8[BX]</font> |

</summary>

- `[寄存器+立即数]`或`立即数[寄存器]`的寻址方式是寄存器相对寻址方式，此时的寄存器中存放的是一个地址，立即数是一个位移量disp；
  - 寄存器可以是基址寄存器BX、BP，也可以是变址寄存器SI、DI；
  - 若指令中使用的是通用寄存器
    - 即它们默认与DS段寄存器配合
  - 若使用的是`BP,EBP,ESP`
    - 则缺省情况默认与SS段寄存器配合
 
</details>

<details>
<summary>基址变址寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 基址变址寻址方式 | MOV AX, <font color=red>[BX][SI]</font> |

</summary>

- `[基址寄存器+变址寄存器]`或`[基址寄存器][变址寄存器]`的寻址方式是基址变址寻址方式，此时的两个寄存器中存放的是一个地址和一个偏移量；
  - 变址寄存器不可以是ESP；

</details>

<details>
<summary>相对基址变址寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 相对基址变址寻址方式 | MOV AX, <font color=red>ARRY[BX][SI]</font> |

</summary>

- `[基址寄存器+变址寄存器+立即数]`或`立即数[基址寄存器][变址寄存器]`的寻址方式是相对基址变址寻址方式，此时的两个寄存器中存放的是一个地址和一个偏移量，立即数是一个位移量；

</details>

<details>
<summary>比例变址寻址方式

| 寻址方式 | 例子 |
| --- | --- |
| 比例变址寻址方式 | MOV EAX, <font color=red>ES:ARRY[4*BX]</font> |

</summary>

- `[基址寄存器+变址寄存器*比例因子+立即数]`或`立即数[基址寄存器][变址寄存器*比例因子]`的寻址方式是比例变址寻址方式，比例因子是一个常数。

</details>


### 习题

<details>
<summary>
*习题 3.4* 在实模式下 ，设(DS)=1000H， (ES)=2000H，(SS)=1200H，(BX)=0300H，
(SI)=0200H，(BP)=0100H，VAR 的偏移量为 0060H。若目标操作数为存储器操作数，试计算下列各指令执行后目标操作数的物理地址是多少。

（1）`MOV AX,123` （2）`MOV DL,15`
（3）`MOV [BX],DX` （4）`MOV [0500H],DX`
（5）`MOV VAR,90H` （6）`MOV 6[BX],AX`
（7）`MOV 6[BP][SI],AL` （8）`MOV ES:[BX][SI],CX`
</summary>
答案：

| 题号 | 物理地址 | 解析 |
| --- | --- | --- |
| (1) | --- | CPU 寻址，没有物理地址 |
| (2) | --- | CPU 寻址，没有物理地址 |
| (3) | 10300H | 数据段，可以写成`DS:[BX]`，所以物理地址为 1000H x 10H + 0300H = 10300H |
| (4) | 0500H | 数据段，可以写成`DS:[0500H]`，所以物理地址为 1000H x 10H + 0500H = 10500H |
| (5) | 10060H | 数据段，可以写成`DS:VAR`，所以物理地址为 1000H x 10H + 0060H = 10060H |
| (6) | 10306H | 数据段，可以写成`DS:[6+BX]`，所以物理地址为 1000H x 10H + 0306H = 10306H |
| (7) | 12306H | 堆栈段，可以写成`SS:[6+BP+SI]`，所以物理地址为 1200H x 10H + 6 + 0100H + 0200H = 12306H |
| (8) | 20306H | 附加段，可以写成`ES:[6+BX+SI]`，所以物理地址为 2000H x 10H + 0300H + 0200H = 20500H |
</details>



