## 中断概述

### 中断、异常（故障、 陷阱、中止）

中断基本原理

- <font color=red>使CPU中止正在执行的程序而转去处理特殊事件的操作</font>。这些引起中断的事件称为中断源。
- Intel系列微处理器的对外的中断引脚包括两个申请中断的硬件引脚（INTR和NMI），一个响应INTR中断的硬件引脚（INTA）。除此之外微处理器还有软件中断INT，INTO，INT3和BOUND。
- 中断结构中的2个标志位IF（Interrupt Flag，中断标志）和TF（Trap Flag，陷阱标志）和一个特殊的返回指令IRET/IRETD。

中断分类

- CPU把中断分为内部中断和外部中断两大类。为了支持多任务和虚拟存储器等功能，保护模式下，把**外部中断**称为“中断”（Interrupt），把**内部中断**称为“异常”（Exception）。通常在两条指令之间响应中断或异常。CPU最多处理256种中断或异常。
- 中断可以分为可屏蔽中断和不可屏蔽中断。
  - INTR：标志寄存器EFLAGS 中的IF 标志决定是否响应INTR 的中断请求
  - NMI：不可屏蔽中断
  - 这两个引脚接外部终端

### 补充

异常分类

- 故障：故障是在引起异常的指令之前，把异常情况通知给系统的一种情况。故障的特点是可排除。
- 陷阱：陷阱是在引起异常的指令执行之后触发的一种情况。软中断指令“INT n”、单步异常等。
- 终止：系统出现严重的不可恢复的事件时触发的一种异常，产生中止后，正执行的程序不能被恢复执行，系统要重新启动才能恢复正常运行状态。

![异常的类型及其向量号](异常的类型及其向量号.png)

- `INT 3`是断点中断，指令码为0CCH，只占一个字节。在调试程序时，在程序的某处设置断点，就是用这个字节替换程序中的指令，执行到0CCH时就会暂停，以便检查并显示当前寄存器以及变量的内容。

### INT 21H

> GPT-3.5-turbo

在汇编语言中，使用INT 21H指令可以调用DOS中断服务程序，实现各种功能，包括数据输入输出。以下是INT 21H中的一些常见功能：

1. **INT 21H, Function 01H - Read Character from Standard Input, with Echo (读取字符并回显)：**
   ```assembly
   MOV AH, 01H       ; 功能号
   INT 21H          ; 调用中断
   MOV DL, AL       ; 将读取的字符存储在DL寄存器中
   ; 此时DL中包含了读取的字符
   ```

2. **INT 21H, Function 02H - Write Character to Standard Output (写字符到标准输出)：**
   ```assembly
   MOV AH, 02H       ; 功能号
   MOV DL, 'A'       ; 要写入的字符
   INT 21H          ; 调用中断
   ; 此时字符 'A' 被写入标准输出
   ```

3. **INT 21H, Function 09H - Write String to Standard Output (写字符串到标准输出)：**
   ```assembly
   MOV AH, 09H       ; 功能号
   LEA DX, Msg       ; 存储字符串的地址，Msg是字符串的标签
   INT 21H          ; 调用中断
   ; 此时字符串被写入标准输出
   Msg DB 'Hello, World$', 0   ; 字符串以'$'结束
   ```

4. **INT 21H, Function 0AH - Buffered Input (带缓冲区的输入)：**
   ```assembly
   MOV AH, 0AH       ; 功能号
   MOV DX, Buffer    ; 缓冲区地址
   INT 21H          ; 调用中断
   ; 此时输入的字符串被存储在Buffer中
   Buffer DB 10      ; 缓冲区大小
   ```

这些例子演示了如何使用INT 21H中的不同功能来实现输入和输出操作。请注意，这些功能在实际程序中通常会被更复杂的逻辑所包围，例如循环、条件判断等，以满足具体的需求。